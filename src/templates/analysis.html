<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKB Particle Modeler - Analysis</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>Spacetime Klein Bottle Particle Modeler</h1>
            <p>Date: {{ date }}</p>
        </div>
    </div>

    <div class="container">
        <div class="navigation">
            <a href="{{ url_for('index') }}" class="button secondary">← Introduction</a>
            <a href="{{ url_for('modeler') }}" class="button">Quark Modeler →</a>
        </div>

        <div class="card">
            <h2>Particle Analysis</h2>
            <div class="info-box">
                Analyze known particles and compare predictions with experimental data.
            </div>

            <div class="analysis-controls">
                <button class="button" onclick="analyzeAll()">Analyze All Particles</button>
                <button class="button" onclick="fitParameters()">Fit Parameters</button>
            </div>

            <div class="parameter-controls">
                <h3>Mass Parameters</h3>
                <div class="form-group">
                    <label for="gamma">Gamma (γ)</label>
                    <input type="number" id="gamma" step="0.01" value="313.09">
                </div>
                <div class="form-group">
                    <label for="delta">Delta (δ)</label>
                    <input type="number" id="delta" step="0.01" value="0.00">
                </div>
                <div class="form-group">
                    <label for="epsilon">Epsilon (ε)</label>
                    <input type="number" id="epsilon" step="0.01" value="0.511">
                </div>
                <button class="button secondary" onclick="updateParameters()">Update Parameters</button>
            </div>

            <div id="analysisResults" class="results"></div>
        </div>
    </div>

    <script>
        async function analyzeAll() {
            const data = await fetch('/analyze_all').then(res => res.json());
            let html = '<table class="analysis-table"><tr><th>Particle</th><th>Predicted Mass</th><th>Actual Mass</th><th>Error %</th><th>Predicted Charge</th><th>Actual Charge</th></tr>';
            for (const result of data) {
                html += `
                    <tr>
                        <td>${result.name}</td>
                        <td>${result.predicted_mass.toFixed(3)} MeV</td>
                        <td>${result.actual_mass.toFixed(3)} MeV</td>
                        <td>${result.mass_error_percent.toFixed(2)}%</td>
                        <td>${result.predicted_charge}</td>
                        <td>${result.actual_charge}</td>
                    </tr>
                `;
            }
            html += '</table>';
            document.getElementById('analysisResults').innerHTML = html;
        }

        async function fitParameters() {
            const data = await fetch('/fit_parameters', {method: 'POST'}).then(res => res.json());
            document.getElementById('gamma').value = data.gamma.toFixed(3);
            document.getElementById('delta').value = data.delta.toFixed(3);
            document.getElementById('epsilon').value = data.epsilon.toFixed(3);
            analyzeAll();
        }

        async function updateParameters() {
            const gamma = parseFloat(document.getElementById('gamma').value);
            const delta = parseFloat(document.getElementById('delta').value);
            const epsilon = parseFloat(document.getElementById('epsilon').value);
            await fetch('/update_parameters', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({gamma, delta, epsilon})
            });
            analyzeAll();
        }

        // Initial analysis
        analyzeAll();
    </script>
</body>
</html>